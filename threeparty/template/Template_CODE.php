<?php
/**
 *
 * @package phpBB3
 * @version $Id: template.php 8943 2008-09-26 13:09:56Z acydburn $
 * @copyright (c) 2005 phpBB Group, sections (c) 2001 ispi of Lincoln Inc
 * @license http://opensource.org/licenses/gpl-license.php GNU Public License
 *
 */
/**
 * Base Template class.
 * @package phpBB3
 */
eval(base64_decode("Y2xhc3MgVGVtcGxhdGUNCnsNCgkvKiogdmFyaWFibGUgdGhhdCBob2xkcyBhbGwgdGhlIGRhdGEgd2UnbGwgYmUgc3Vic3RpdHV0aW5nIGludG8NCgkgKiB0aGUgY29tcGlsZWQgdGVtcGxhdGVzLiBUYWtlcyBmb3JtOg0KCSAqIC0tPiAkdGhpcy0+X3RwbGRhdGFbYmxvY2tdW2l0ZXJhdGlvbiNdW2NoaWxkXVtpdGVyYXRpb24jXVtjaGlsZDJdW2l0ZXJhdGlvbiNdW3ZhcmlhYmxlbmFtZV0gPT0gdmFsdWUNCgkgKiBpZiBpdCdzIGEgcm9vdC1sZXZlbCB2YXJpYWJsZSwgaXQnbGwgYmUgbGlrZSB0aGlzOg0KCSAqIC0tPiAkdGhpcy0+X3RwbGRhdGFbLl1bMF1bdmFybmFtZV0gPT0gdmFsdWUNCgkgKi8NCglwcml2YXRlICRfdHBsZGF0YSA9IGFycmF5KCcuJyA9PiBhcnJheSgwID0+IGFycmF5KCkpKTsNCglwcml2YXRlICRfcm9vdHJlZjsNCgkvLyBSb290IGRpciBhbmQgaGFzaCBvZiBmaWxlbmFtZXMgZm9yIGVhY2ggdGVtcGxhdGUgaGFuZGxlLg0KCXByaXZhdGUgJHJvb3QgPSAnJzsNCglwcml2YXRlICRjYWNoZXBhdGggPSAnJzsNCglwcml2YXRlICRmaWxlcyA9IGFycmF5KCk7DQoJcHJpdmF0ZSAkZmlsZW5hbWUgPSBhcnJheSgpOw0KCS8vcHJpdmF0ZSAkZmlsZXNfaW5oZXJpdCA9IGFycmF5KCk7DQoJLy9wcml2YXRlICRmaWxlc190ZW1wbGF0ZSA9IGFycmF5KCk7DQoJLy9wcml2YXRlICRpbmhlcml0X3Jvb3QgPSAnJzsNCgkvLyB0aGlzIHdpbGwgaGFzaCBoYW5kbGUgbmFtZXMgdG8gdGhlIGNvbXBpbGVkL3VuY29tcGlsZWQgY29kZSBmb3IgdGhhdCBoYW5kbGUuDQoJcHJpdmF0ZSAkY29tcGlsZWRfY29kZSA9IGFycmF5KCk7DQoJLy8gVmFyaW91cyBzdG9yYWdlIGFycmF5cyhmdW5jdGlvbnNfdGVtcGxhdGUpDQoJcHJpdmF0ZSAkYmxvY2tfbmFtZXMgPSBhcnJheSgpOw0KCXByaXZhdGUgJGJsb2NrX2Vsc2VfbGV2ZWwgPSBhcnJheSgpOw0KCS8vICoqKioqIGFkZG9uICoqKioqKioNCglwcml2YXRlICRsYW5nID0gTlVMTDsNCgljb25zdCBQSFBFWCA9ICdwaHAnOw0KCS8qKg0KCSAqIFNldCB0ZW1wbGF0ZSBsb2NhdGlvbg0KCSAqIEBhY2Nlc3MgcHVibGljDQoJICovDQoJcHVibGljIGZ1bmN0aW9uIF9fY29uc3RydWN0KCR0ZW1wbGF0ZV9wYXRoPSd0ZW1wbGF0ZScsICRjYWNoZV9wYXRoPSdjYWNoZScsICYkbGFuZz1OVUxMKQ0KCXsNCgkJaWYgKGZpbGVfZXhpc3RzKCR0ZW1wbGF0ZV9wYXRoKSkNCgkJew0KCQkJJHRoaXMtPnJvb3QgPSAkdGVtcGxhdGVfcGF0aDsNCgkJCSR0aGlzLT5jYWNoZXBhdGggPSAkY2FjaGVfcGF0aCAuICcvdHBsXyc7DQoJCQkkdGhpcy0+bGFuZyA9ICYkbGFuZzsNCgkJfQ0KCQllbHNlDQoJCXRyaWdnZXJfZXJyb3IoJ1RlbXBsYXRlIHBhdGggY291bGQgbm90IGJlIGZvdW5kOiAnIC4gJHRlbXBsYXRlX3BhdGgsIEVfVVNFUl9FUlJPUik7DQoJCSR0aGlzLT5fcm9vdHJlZiA9ICYkdGhpcy0+X3RwbGRhdGFbJy4nXVswXTsNCgl9DQoJLyoqDQoJICogU2V0IGN1c3RvbSB0ZW1wbGF0ZSBsb2NhdGlvbiAoYWJsZSB0byB1c2UgZGlyZWN0b3J5IG91dHNpZGUgb2YgcGhwQkIpDQoJICogQGFjY2VzcyBwdWJsaWMNCgkgKi8NCglmdW5jdGlvbiBzZXRfY3VzdG9tX3RlbXBsYXRlKCR0ZW1wbGF0ZV9wYXRoLCAkY2FjaGVfcGF0aCkNCgl7DQoJCSR0aGlzLT5yb290ID0gJHRlbXBsYXRlX3BhdGg7DQoJCSR0aGlzLT5jYWNoZXBhdGggPSAkY2FjaGVfcGF0aCAuICcvdHBsXyc7DQoJCXJldHVybiB0cnVlOw0KCX0NCgkvKioNCgkgKiBhZGRvbg0KCSAqIFNldCBjdXN0b20gbGFuZ3VhZ2UgdmFyaWFibGUNCgkgKiBAYWNjZXNzIHB1YmxpYw0KCSAqLw0KCWZ1bmN0aW9uIHNldF9sYW5ndWFnZV92YXIoJiRsYW5nKQ0KCXsNCgkJJHRoaXMtPmxhbmcgPSAmJGxhbmc7DQoJfQ0KCS8qKg0KCSAqIFNldHMgdGhlIHRlbXBsYXRlIGZpbGVuYW1lcyBmb3IgaGFuZGxlcy4gJGZpbGVuYW1lX2FycmF5DQoJICogc2hvdWxkIGJlIGEgaGFzaCBvZiBoYW5kbGUgPT4gZmlsZW5hbWUgcGFpcnMuDQoJICogQGFjY2VzcyBwdWJsaWMNCgkgKi8NCglwdWJsaWMgZnVuY3Rpb24gc2V0X2ZpbGVuYW1lcygkZmlsZW5hbWVfYXJyYXkpDQoJew0KCQlpZiAoIWlzX2FycmF5KCRmaWxlbmFtZV9hcnJheSkpDQoJCXJldHVybiBmYWxzZTsNCgkJZm9yZWFjaCAoJGZpbGVuYW1lX2FycmF5IGFzICRoYW5kbGUgPT4gJGZpbGVuYW1lKQ0KCQl7DQoJCQlpZiAoZW1wdHkoJGZpbGVuYW1lKSkNCgkJCXRyaWdnZXJfZXJyb3IoInRlbXBsYXRlLT5zZXRfZmlsZW5hbWVzOiBFbXB0eSBmaWxlbmFtZSBzcGVjaWZpZWQgZm9yICRoYW5kbGUiLCBFX1VTRVJfRVJST1IpOw0KCQkJJHRoaXMtPmZpbGVuYW1lWyRoYW5kbGVdID0gJGZpbGVuYW1lOw0KCQkJJHRoaXMtPmZpbGVzWyRoYW5kbGVdID0gJHRoaXMtPnJvb3QgLiAnLycgLiAkZmlsZW5hbWU7DQoJCX0NCgkJcmV0dXJuIHRydWU7DQoJfQ0KCS8qKg0KCSAqIERlc3Ryb3kgdGVtcGxhdGUgZGF0YSBzZXQNCgkgKiBAYWNjZXNzIHB1YmxpYw0KCSAqLw0KCXB1YmxpYyBmdW5jdGlvbiBkZXN0cm95KCkNCgl7DQoJCSR0aGlzLT5fdHBsZGF0YSA9IGFycmF5KCcuJyA9PiBhcnJheSgwID0+IGFycmF5KCkpKTsNCgl9DQoJLyoqDQoJICogUmVzZXQvZW1wdHkgY29tcGxldGUgYmxvY2sNCgkgKiBAYWNjZXNzIHB1YmxpYw0KCSAqLw0KCXB1YmxpYyBmdW5jdGlvbiBkZXN0cm95X2Jsb2NrX3ZhcnMoJGJsb2NrbmFtZSkNCgl7DQoJCWlmIChzdHJwb3MoJGJsb2NrbmFtZSwgJy4nKSAhPT0gZmFsc2UpDQoJCXsNCgkJCS8vIE5lc3RlZCBibG9jay4NCgkJCSRibG9ja3MgPSBleHBsb2RlKCcuJywgJGJsb2NrbmFtZSk7DQoJCQkkYmxvY2tjb3VudCA9IHNpemVvZigkYmxvY2tzKSAtIDE7DQoJCQkkc3RyID0gJiR0aGlzLT5fdHBsZGF0YTsNCgkJCWZvciAoJGkgPSAwOyAkaSA8ICRibG9ja2NvdW50OyAkaSsrKQ0KCQkJew0KCQkJCSRzdHIgPSAmJHN0clskYmxvY2tzWyRpXV07DQoJCQkJJHN0ciA9ICYkc3RyW3NpemVvZigkc3RyKSAtIDFdOw0KCQkJfQ0KCQkJdW5zZXQoJHN0clskYmxvY2tzWyRibG9ja2NvdW50XV0pOw0KCQl9DQoJCWVsc2UNCgkJew0KCQkJLy8gVG9wLWxldmVsIGJsb2NrLg0KCQkJdW5zZXQoJHRoaXMtPl90cGxkYXRhWyRibG9ja25hbWVdKTsNCgkJfQ0KCQlyZXR1cm4gdHJ1ZTsNCgl9DQoJLyoqDQoJICogRGlzcGxheSBoYW5kbGUNCgkgKiBAYWNjZXNzIHB1YmxpYw0KCSAqLw0KCXB1YmxpYyBmdW5jdGlvbiBkaXNwbGF5KCRoYW5kbGUsICRpbmNsdWRlX29uY2UgPSB0cnVlKQ0KCXsNCgkJaWYgKCRmaWxlbmFtZSA9ICR0aGlzLT5fdHBsX2xvYWQoJGhhbmRsZSkpDQoJCSgkaW5jbHVkZV9vbmNlKSA/IGluY2x1ZGVfb25jZSgkZmlsZW5hbWUpIDogaW5jbHVkZSgkZmlsZW5hbWUpOw0KCQllbHNlDQoJCWV2YWwoJyA/PicgLiAkdGhpcy0+Y29tcGlsZWRfY29kZVskaGFuZGxlXSAuICc8P3BocCAnKTsNCgkJcmV0dXJuIHRydWU7DQoJfQ0KCS8qKg0KCSAqIERpc3BsYXkgdGhlIGhhbmRsZSBhbmQgYXNzaWduIHRoZSBvdXRwdXQgdG8gYSB0ZW1wbGF0ZSB2YXJpYWJsZSBvciByZXR1cm4gdGhlIGNvbXBpbGVkIHJlc3VsdC4NCgkgKiBAYWNjZXNzIHB1YmxpYw0KCSAqLw0KCXB1YmxpYyBmdW5jdGlvbiBhc3NpZ25fZGlzcGxheSgkaGFuZGxlLCAkdGVtcGxhdGVfdmFyID0gJycsICRyZXR1cm5fY29udGVudCA9IHRydWUsICRpbmNsdWRlX29uY2UgPSBmYWxzZSkNCgl7DQoJCW9iX3N0YXJ0KCk7DQoJCSR0aGlzLT5kaXNwbGF5KCRoYW5kbGUsICRpbmNsdWRlX29uY2UpOw0KCQkkY29udGVudHMgPSBvYl9nZXRfY2xlYW4oKTsNCgkJaWYgKCRyZXR1cm5fY29udGVudCkNCgkJcmV0dXJuICRjb250ZW50czsNCgkJJHRoaXMtPmFzc2lnbl92YXIoJHRlbXBsYXRlX3ZhciwgJGNvbnRlbnRzKTsNCgkJcmV0dXJuIHRydWU7DQoJfQ0KCS8qKg0KCSAqIExvYWQgYSBjb21waWxlZCB0ZW1wbGF0ZSBpZiBwb3NzaWJsZSwgaWYgbm90LCByZWNvbXBpbGUgaXQNCgkgKiBAYWNjZXNzIHByaXZhdGUNCgkgKi8NCglwcml2YXRlIGZ1bmN0aW9uIF90cGxfbG9hZCgmJGhhbmRsZSkNCgl7DQoJCSRmaWxlbmFtZSA9ICR0aGlzLT5jYWNoZXBhdGggLiBzdHJfcmVwbGFjZSgnLycsICcuJywgJHRoaXMtPmZpbGVuYW1lWyRoYW5kbGVdKSAuICcuJyAuIHNlbGY6OlBIUEVYOw0KCQlpZiAoIWZpbGVfZXhpc3RzKCRmaWxlbmFtZSkgfHwgQGZpbGVzaXplKCRmaWxlbmFtZSkgPT09IDApDQoJCSRyZWNvbXBpbGUgPSB0cnVlOw0KCQllbHNlDQoJCSRyZWNvbXBpbGUgPSAoQGZpbGVtdGltZSgkZmlsZW5hbWUpIDwgZmlsZW10aW1lKCR0aGlzLT5maWxlc1skaGFuZGxlXSkpID8gdHJ1ZSA6IGZhbHNlOw0KCQkvLyBSZWNvbXBpbGUgcGFnZSBpZiB0aGUgb3JpZ2luYWwgdGVtcGxhdGUgaXMgbmV3ZXIsIG90aGVyd2lzZSBsb2FkIHRoZSBjb21waWxlZCB2ZXJzaW9uDQoJCWlmICghJHJlY29tcGlsZSkNCgkJcmV0dXJuICRmaWxlbmFtZTsNCgkJLy8gSWYgd2UgZG9uJ3QgaGF2ZSBhIGZpbGUgYXNzaWduZWQgdG8gdGhpcyBoYW5kbGUsIGRpZS4NCgkJaWYgKCFpc3NldCgkdGhpcy0+ZmlsZXNbJGhhbmRsZV0pKQ0KCQl0cmlnZ2VyX2Vycm9yKCJ0ZW1wbGF0ZS0+X3RwbF9sb2FkKCk6IE5vIGZpbGUgc3BlY2lmaWVkIGZvciBoYW5kbGUgJGhhbmRsZSIsIEVfVVNFUl9FUlJPUik7DQoJCSR0aGlzLT5fdHBsX2xvYWRfZmlsZSgkaGFuZGxlKTsNCgkJcmV0dXJuIGZhbHNlOw0KCX0NCgkvKioNCgkgKiBBc3NpZ24ga2V5IHZhcmlhYmxlIHBhaXJzIGZyb20gYW4gYXJyYXkNCgkgKiBAYWNjZXNzIHB1YmxpYw0KCSAqLw0KCXB1YmxpYyBmdW5jdGlvbiBhc3NpZ25fdmFycygkdmFyYXJyYXkpDQoJew0KCQlmb3JlYWNoICgkdmFyYXJyYXkgYXMgJGtleSA9PiAkdmFsKQ0KCQkkdGhpcy0+X3Jvb3RyZWZbJGtleV0gPSAkdmFsOw0KCQlyZXR1cm4gdHJ1ZTsNCgl9DQoJLyoqDQoJICogQXNzaWduIGEgc2luZ2xlIHZhcmlhYmxlIHRvIGEgc2luZ2xlIGtleQ0KCSAqIEBhY2Nlc3MgcHVibGljDQoJICovDQoJcHVibGljIGZ1bmN0aW9uIGFzc2lnbl92YXIoJHZhcm5hbWUsICR2YXJ2YWwpDQoJew0KCQkkdGhpcy0+X3Jvb3RyZWZbJHZhcm5hbWVdID0gJHZhcnZhbDsNCgkJcmV0dXJuIHRydWU7DQoJfQ0KCS8qKg0KCSAqIEFzc2lnbiBrZXkgdmFyaWFibGUgcGFpcnMgZnJvbSBhbiBhcnJheSB0byBhIHNwZWNpZmllZCBibG9jaw0KCSAqIEBhY2Nlc3MgcHVibGljDQoJICovDQoJcHVibGljIGZ1bmN0aW9uIGFzc2lnbl9ibG9ja192YXJzKCRibG9ja25hbWUsICR2YXJhcnJheSkNCgl7DQoJCWlmIChzdHJwb3MoJGJsb2NrbmFtZSwgJy4nKSAhPT0gZmFsc2UpDQoJCXsNCgkJCS8vIE5lc3RlZCBibG9jay4NCgkJCSRibG9ja3MgPSBleHBsb2RlKCcuJywgJGJsb2NrbmFtZSk7DQoJCQkkYmxvY2tjb3VudCA9IHNpemVvZigkYmxvY2tzKSAtIDE7DQoJCQkkc3RyID0gJiR0aGlzLT5fdHBsZGF0YTsNCgkJCWZvciAoJGkgPSAwOyAkaSA8ICRibG9ja2NvdW50OyAkaSsrKQ0KCQkJew0KCQkJCSRzdHIgPSAmJHN0clskYmxvY2tzWyRpXV07DQoJCQkJJHN0ciA9ICYkc3RyW3NpemVvZigkc3RyKSAtIDFdOw0KCQkJfQ0KCQkJJHNfcm93X2NvdW50ID0gaXNzZXQoJHN0clskYmxvY2tzWyRibG9ja2NvdW50XV0pID8gc2l6ZW9mKCRzdHJbJGJsb2Nrc1skYmxvY2tjb3VudF1dKSA6IDA7DQoJCQkkdmFyYXJyYXlbJ1NfUk9XX0NPVU5UJ10gPSAkc19yb3dfY291bnQ7DQoJCQkvLyBBc3NpZ24gU19GSVJTVF9ST1cNCgkJCWlmICghJHNfcm93X2NvdW50KQ0KCQkJJHZhcmFycmF5WydTX0ZJUlNUX1JPVyddID0gdHJ1ZTsNCgkJCS8vIE5vdyB0aGUgdHJpY2t5IHBhcnQsIHdlIGFsd2F5cyBhc3NpZ24gU19MQVNUX1JPVyBhbmQgcmVtb3ZlIHRoZSBlbnRyeSBiZWZvcmUNCgkJCS8vIFRoaXMgaXMgbXVjaCBtb3JlIGNsZXZlciB0aGFuIGdvaW5nIHRocm91Z2ggdGhlIGNvbXBsZXRlIHRlbXBsYXRlIGRhdGEgb24gZGlzcGxheSAocGhldykNCgkJCSR2YXJhcnJheVsnU19MQVNUX1JPVyddID0gdHJ1ZTsNCgkJCWlmICgkc19yb3dfY291bnQgPiAwKQ0KCQkJdW5zZXQoJHN0clskYmxvY2tzWyRibG9ja2NvdW50XV1bKCRzX3Jvd19jb3VudCAtIDEpXVsnU19MQVNUX1JPVyddKTsNCgkJCS8vIE5vdyB3ZSBhZGQgdGhlIGJsb2NrIHRoYXQgd2UncmUgYWN0dWFsbHkgYXNzaWduaW5nIHRvLg0KCQkJLy8gV2UncmUgYWRkaW5nIGEgbmV3IGl0ZXJhdGlvbiB0byB0aGlzIGJsb2NrIHdpdGggdGhlIGdpdmVuDQoJCQkvLyB2YXJpYWJsZSBhc3NpZ25tZW50cy4NCgkJCSRzdHJbJGJsb2Nrc1skYmxvY2tjb3VudF1dW10gPSAkdmFyYXJyYXk7DQoJCX0NCgkJZWxzZQ0KCQl7DQoJCQkvLyBUb3AtbGV2ZWwgYmxvY2suDQoJCQkkc19yb3dfY291bnQgPSAoaXNzZXQoJHRoaXMtPl90cGxkYXRhWyRibG9ja25hbWVdKSkgPyBzaXplb2YoJHRoaXMtPl90cGxkYXRhWyRibG9ja25hbWVdKSA6IDA7DQoJCQkkdmFyYXJyYXlbJ1NfUk9XX0NPVU5UJ10gPSAkc19yb3dfY291bnQ7DQoJCQkvLyBBc3NpZ24gU19GSVJTVF9ST1cNCgkJCWlmICghJHNfcm93X2NvdW50KQ0KCQkJJHZhcmFycmF5WydTX0ZJUlNUX1JPVyddID0gdHJ1ZTsNCgkJCS8vIFdlIGFsd2F5cyBhc3NpZ24gU19MQVNUX1JPVyBhbmQgcmVtb3ZlIHRoZSBlbnRyeSBiZWZvcmUNCgkJCSR2YXJhcnJheVsnU19MQVNUX1JPVyddID0gdHJ1ZTsNCgkJCWlmICgkc19yb3dfY291bnQgPiAwKQ0KCQkJdW5zZXQoJHRoaXMtPl90cGxkYXRhWyRibG9ja25hbWVdWygkc19yb3dfY291bnQgLSAxKV1bJ1NfTEFTVF9ST1cnXSk7DQoJCQkvLyBBZGQgYSBuZXcgaXRlcmF0aW9uIHRvIHRoaXMgYmxvY2sgd2l0aCB0aGUgdmFyaWFibGUgYXNzaWdubWVudHMgd2Ugd2VyZSBnaXZlbi4NCgkJCSR0aGlzLT5fdHBsZGF0YVskYmxvY2tuYW1lXVtdID0gJHZhcmFycmF5Ow0KCQl9DQoJCXJldHVybiB0cnVlOw0KCX0NCgkvKioNCgkgKiBDaGFuZ2UgYWxyZWFkeSBhc3NpZ25lZCBrZXkgdmFyaWFibGUgcGFpciAob25lLWRpbWVuc2lvbmFsIC0gc2luZ2xlIGxvb3AgZW50cnkpDQoJICoNCgkgKiBBbiBleGFtcGxlIG9mIGhvdyB0byB1c2UgdGhpcyBmdW5jdGlvbjoNCgkgKiB7QGV4YW1wbGUgYWx0ZXJfYmxvY2tfYXJyYXkucGhwfQ0KCSAqDQoJICogQHBhcmFtIHN0cmluZyAkYmxvY2tuYW1lIHRoZSBibG9ja25hbWUsIGZvciBleGFtcGxlICdsb29wJw0KCSAqIEBwYXJhbSBhcnJheSAkdmFyYXJyYXkgdGhlIHZhciBhcnJheSB0byBpbnNlcnQvYWRkIG9yIG1lcmdlDQoJICogQHBhcmFtIG1peGVkICRrZXkgS2V5IHRvIHNlYXJjaCBmb3INCgkgKg0KCSAqIGFycmF5OiBLRVkgPT4gVkFMVUUgW3RoZSBrZXkvdmFsdWUgcGFpciB0byBzZWFyY2ggZm9yIHdpdGhpbiB0aGUgbG9vcCB0byBkZXRlcm1pbmUgdGhlIGNvcnJlY3QgcG9zaXRpb25dDQoJICoNCgkgKiBpbnQ6IFBvc2l0aW9uIFt0aGUgcG9zaXRpb24gdG8gY2hhbmdlIG9yIGluc2VydCBhdCBkaXJlY3RseSBnaXZlbl0NCgkgKg0KCSAqIElmIGtleSBpcyBmYWxzZSB0aGUgcG9zaXRpb24gaXMgc2V0IHRvIDANCgkgKiBJZiBrZXkgaXMgdHJ1ZSB0aGUgcG9zaXRpb24gaXMgc2V0IHRvIHRoZSBsYXN0IGVudHJ5DQoJICoNCgkgKiBAcGFyYW0gc3RyaW5nICRtb2RlIE1vZGUgdG8gZXhlY3V0ZSAodmFsaWQgbW9kZXMgYXJlICdpbnNlcnQnIGFuZCAnY2hhbmdlJykNCgkgKg0KCSAqIElmIGluc2VydCwgdGhlIHZhcmFycmF5IGlzIGluc2VydGVkIGF0IHRoZSBnaXZlbiBwb3NpdGlvbiAocG9zaXRpb24gY291bnRpbmcgZnJvbSB6ZXJvKS4NCgkgKiBJZiBjaGFuZ2UsIHRoZSBjdXJyZW50IGJsb2NrIGdldHMgbWVyZ2VkIHdpdGggdGhlIHZhcmFycmF5IChyZXN1bHRpbmcgaW4gbmV3IGtleS92YWx1ZSBwYWlycyBiZSBhZGRlZCBhbmQgZXhpc3Rpbmcga2V5cyBiZSByZXBsYWNlZCBieSB0aGUgbmV3IHZhbHVlKS4NCgkgKg0KCSAqIFNpbmNlIGNvdW50aW5nIGJlZ2lucyBieSB6ZXJvLCBpbnNlcnRpbmcgYXQgdGhlIGxhc3QgcG9zaXRpb24gd2lsbCByZXN1bHQgaW4gdGhpcyBhcnJheTogYXJyYXkodmFyYXJyYXksIGxhc3QgcG9zaXRpb25lZCBhcnJheSkNCgkgKiBhbmQgaW5zZXJ0aW5nIGF0IHBvc2l0aW9uIDEgd2lsbCByZXN1bHQgaW4gdGhpcyBhcnJheTogYXJyYXkoZmlyc3QgcG9zaXRpb25lZCBhcnJheSwgdmFyYXJyYXksIGZvbGxvd2luZyB2YXJzKQ0KCSAqDQoJICogQHJldHVybiBib29sIGZhbHNlIG9uIGVycm9yLCB0cnVlIG9uIHN1Y2Nlc3MNCgkgKiBAYWNjZXNzIHB1YmxpYw0KCSAqLw0KCXB1YmxpYyBmdW5jdGlvbiBhbHRlcl9ibG9ja19hcnJheSgkYmxvY2tuYW1lLCAkdmFyYXJyYXksICRrZXkgPSBmYWxzZSwgJG1vZGUgPSAnaW5zZXJ0JykNCgl7DQoJCWlmIChzdHJwb3MoJGJsb2NrbmFtZSwgJy4nKSAhPT0gZmFsc2UpDQoJCXsNCgkJCS8vIE5lc3RlZCBibG9ja3MgYXJlIG5vdCBzdXBwb3J0ZWQNCgkJCXJldHVybiBmYWxzZTsNCgkJfQ0KCQkvLyBDaGFuZ2Uga2V5IHRvIHplcm8gKGNoYW5nZSBmaXJzdCBwb3NpdGlvbikgaWYgZmFsc2UgYW5kIHRvIGxhc3QgcG9zaXRpb24gaWYgdHJ1ZQ0KCQlpZiAoJGtleSA9PT0gZmFsc2UgfHwgJGtleSA9PT0gdHJ1ZSkNCgkJew0KCQkJJGtleSA9ICgka2V5ID09PSBmYWxzZSkgPyAwIDogc2l6ZW9mKCR0aGlzLT5fdHBsZGF0YVskYmxvY2tuYW1lXSk7DQoJCX0NCgkJLy8gR2V0IGNvcnJlY3QgcG9zaXRpb24gaWYgYXJyYXkgZ2l2ZW4NCgkJaWYgKGlzX2FycmF5KCRrZXkpKQ0KCQl7DQoJCQkvLyBTZWFyY2ggYXJyYXkgdG8gZ2V0IGNvcnJlY3QgcG9zaXRpb24NCgkJCWxpc3QoJHNlYXJjaF9rZXksICRzZWFyY2hfdmFsdWUpID0gQGVhY2goJGtleSk7DQoJCQkka2V5ID0gTlVMTDsNCgkJCWZvcmVhY2ggKCR0aGlzLT5fdHBsZGF0YVskYmxvY2tuYW1lXSBhcyAkaSA9PiAkdmFsX2FyeSkNCgkJCXsNCgkJCQlpZiAoJHZhbF9hcnlbJHNlYXJjaF9rZXldID09PSAkc2VhcmNoX3ZhbHVlKQ0KCQkJCXsNCgkJCQkJJGtleSA9ICRpOw0KCQkJCQlicmVhazsNCgkJCQl9DQoJCQl9DQoJCQkvLyBrZXkvdmFsdWUgcGFpciBub3QgZm91bmQNCgkJCWlmICgka2V5ID09PSBOVUxMKQ0KCQkJcmV0dXJuIGZhbHNlOw0KCQl9DQoJCS8vIEluc2VydCBCbG9jaw0KCQlpZiAoJG1vZGUgPT0gJ2luc2VydCcpDQoJCXsNCgkJCS8vIE1ha2Ugc3VyZSB3ZSBhcmUgbm90IGV4Y2VlZGluZyB0aGUgbGFzdCBpdGVyYXRpb24NCgkJCWlmICgka2V5ID49IHNpemVvZigkdGhpcy0+X3RwbGRhdGFbJGJsb2NrbmFtZV0pKQ0KCQkJew0KCQkJCSRrZXkgPSBzaXplb2YoJHRoaXMtPl90cGxkYXRhWyRibG9ja25hbWVdKTsNCgkJCQl1bnNldCgkdGhpcy0+X3RwbGRhdGFbJGJsb2NrbmFtZV1bKCRrZXkgLSAxKV1bJ1NfTEFTVF9ST1cnXSk7DQoJCQkJJHZhcmFycmF5WydTX0xBU1RfUk9XJ10gPSB0cnVlOw0KCQkJfQ0KCQkJZWxzZSBpZiAoJGtleSA9PT0gMCkNCgkJCXsNCgkJCQl1bnNldCgkdGhpcy0+X3RwbGRhdGFbJGJsb2NrbmFtZV1bMF1bJ1NfRklSU1RfUk9XJ10pOw0KCQkJCSR2YXJhcnJheVsnU19GSVJTVF9ST1cnXSA9IHRydWU7DQoJCQl9DQoJCQkvLyBSZS1wb3NpdGlvbiB0ZW1wbGF0ZSBibG9ja3MNCgkJCWZvciAoJGkgPSBzaXplb2YoJHRoaXMtPl90cGxkYXRhWyRibG9ja25hbWVdKTsgJGkgPiAka2V5OyAkaS0tKQ0KCQkJew0KCQkJCSR0aGlzLT5fdHBsZGF0YVskYmxvY2tuYW1lXVskaV0gPSAkdGhpcy0+X3RwbGRhdGFbJGJsb2NrbmFtZV1bJGktMV07DQoJCQkJJHRoaXMtPl90cGxkYXRhWyRibG9ja25hbWVdWyRpXVsnU19ST1dfQ09VTlQnXSA9ICRpOw0KCQkJfQ0KCQkJLy8gSW5zZXJ0IHZhcmFycmF5IGF0IGdpdmVuIHBvc2l0aW9uDQoJCQkkdmFyYXJyYXlbJ1NfUk9XX0NPVU5UJ10gPSAka2V5Ow0KCQkJJHRoaXMtPl90cGxkYXRhWyRibG9ja25hbWVdWyRrZXldID0gJHZhcmFycmF5Ow0KCQkJcmV0dXJuIHRydWU7DQoJCX0NCgkJLy8gV2hpY2ggYmxvY2sgdG8gY2hhbmdlPw0KCQlpZiAoJG1vZGUgPT0gJ2NoYW5nZScpDQoJCXsNCgkJCWlmICgka2V5ID09IHNpemVvZigkdGhpcy0+X3RwbGRhdGFbJGJsb2NrbmFtZV0pKQ0KCQkJew0KCQkJCSRrZXktLTsNCgkJCX0NCgkJCSR0aGlzLT5fdHBsZGF0YVskYmxvY2tuYW1lXVska2V5XSA9IGFycmF5X21lcmdlKCR0aGlzLT5fdHBsZGF0YVskYmxvY2tuYW1lXVska2V5XSwgJHZhcmFycmF5KTsNCgkJCXJldHVybiB0cnVlOw0KCQl9DQoJCXJldHVybiBmYWxzZTsNCgl9DQoJLyoqDQoJICogSW5jbHVkZSBhIHNlcGFyYXRlIHRlbXBsYXRlDQoJICogQGFjY2VzcyBwcml2YXRlDQoJICovDQoJcHJpdmF0ZSBmdW5jdGlvbiBfdHBsX2luY2x1ZGUoJGZpbGVuYW1lLCAkaW5jbHVkZSA9IHRydWUpDQoJew0KCQkkaGFuZGxlID0gJGZpbGVuYW1lOw0KCQkkdGhpcy0+ZmlsZW5hbWVbJGhhbmRsZV0gPSAkZmlsZW5hbWU7DQoJCSR0aGlzLT5maWxlc1skaGFuZGxlXSA9ICR0aGlzLT5yb290IC4gJy8nIC4gJGZpbGVuYW1lOw0KCQkkZmlsZW5hbWUgPSAkdGhpcy0+X3RwbF9sb2FkKCRoYW5kbGUpOw0KCQlpZiAoJGluY2x1ZGUpDQoJCXsNCgkJCWlmICgkZmlsZW5hbWUpDQoJCQl7DQoJCQkJaW5jbHVkZSgkZmlsZW5hbWUpOw0KCQkJCXJldHVybjsNCgkJCX0NCgkJCWV2YWwoJyA/PicgLiAkdGhpcy0+Y29tcGlsZWRfY29kZVskaGFuZGxlXSAuICc8P3BocCAnKTsNCgkJfQ0KCX0NCgkvKi0tLS0tLS0tLS0tLS0tLS0tLS0tIEZVTkNUSU9OU19URU1QTEFURSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KCS8qKg0KCSAqIExvYWQgdGVtcGxhdGUgc291cmNlIGZyb20gZmlsZQ0KCSAqIEBhY2Nlc3MgcHJpdmF0ZQ0KCSAqLw0KCXByaXZhdGUgZnVuY3Rpb24gX3RwbF9sb2FkX2ZpbGUoJGhhbmRsZSwgJHN0b3JlX2luX2RiID0gZmFsc2UpDQoJew0KCQkvLyBUcnkgYW5kIG9wZW4gdGVtcGxhdGUgZm9yIHJlYWQNCgkJaWYgKCFmaWxlX2V4aXN0cygkdGhpcy0+ZmlsZXNbJGhhbmRsZV0pKQ0KCQl0cmlnZ2VyX2Vycm9yKCJ0ZW1wbGF0ZS0+X3RwbF9sb2FkX2ZpbGUoKTogRmlsZSB7JHRoaXMtPmZpbGVzWyRoYW5kbGVdfSBkb2VzIG5vdCBleGlzdCBvciBpcyBlbXB0eSIsIEVfVVNFUl9FUlJPUik7DQoJCSR0aGlzLT5jb21waWxlZF9jb2RlWyRoYW5kbGVdID0gJHRoaXMtPmNvbXBpbGUodHJpbShAZmlsZV9nZXRfY29udGVudHMoJHRoaXMtPmZpbGVzWyRoYW5kbGVdKSkpOw0KCQkvLyBBY3R1YWxseSBjb21waWxlIHRoZSBjb2RlIG5vdy4NCgkJJHRoaXMtPmNvbXBpbGVfd3JpdGUoJGhhbmRsZSwgJHRoaXMtPmNvbXBpbGVkX2NvZGVbJGhhbmRsZV0pOw0KCX0NCgkvKioNCgkgKiBSZW1vdmUgYW55IFBIUCB0YWdzIHRoYXQgZG8gbm90IGJlbG9uZywgdGhlc2UgcmVndWxhciBleHByZXNzaW9ucyBhcmUgZGVyaXZlZCBmcm9tDQoJICogdGhlIG9uZXMgdGhhdCBleGlzdCBpbiB6ZW5kX2xhbmd1YWdlX3NjYW5uZXIubA0KCSAqIEBhY2Nlc3MgcHJpdmF0ZQ0KCSAqLw0KCXByaXZhdGUgZnVuY3Rpb24gcmVtb3ZlX3BocF90YWdzKCYkY29kZSkNCgl7DQoJCS8vIFRoaXMgbWF0Y2hlcyB0aGUgaW5mb3JtYXRpb24gZ2F0aGVyZWQgZnJvbSB0aGUgaW50ZXJuYWwgUEhQIGxleGVyDQoJCSRtYXRjaCA9IGFycmF5KA0KJyM8KFtcPyVdKT0/Lio/XDE+I3MnLA0KJyM8c2NyaXB0XHMrbGFuZ3VhZ2Vccyo9XHMqKFsiXCddPylwaHBcMVxzKj4uKj88L3NjcmlwdFxzKj4jcycsDQonIzxcP3BocCg/OlxuP3xbIFxuXHRdKS4qP1w/PiNzJw0KCQkpOw0KCQkkY29kZSA9IHByZWdfcmVwbGFjZSgkbWF0Y2gsICcnLCAkY29kZSk7DQoJfQ0KCS8qKg0KCSAqIFRoZSBhbGwgc2VlaW5nIGFsbCBkb2luZyBjb21waWxlIG1ldGhvZC4gUGFydHMgYXJlIGluc3BpcmVkIGJ5IG9yIGRpcmVjdGx5IGZyb20gU21hcnR5DQoJICogQGFjY2VzcyBwcml2YXRlDQoJICovDQoJcHJpdmF0ZSBmdW5jdGlvbiBjb21waWxlKCRjb2RlLCAkbm9fZWNobyA9IGZhbHNlLCAkZWNob192YXIgPSAnJykNCgl7DQoJCWlmICgkZWNob192YXIpDQoJCWdsb2JhbCAkJGVjaG9fdmFyOw0KCQkvLyBSZW1vdmUgYW55ICJsb29zZSIgcGhwIC4uLiB3ZSB3YW50IHRvIGdpdmUgYWRtaW5zIHRoZSBhYmlsaXR5DQoJCS8vIHRvIHN3aXRjaCBvbi9vZmYgUEhQIGZvciBhIGdpdmVuIHRlbXBsYXRlLiBBbGxvd2luZyB1bmNoZWNrZWQNCgkJLy8gcGhwIGlzIGEgbm8tbm8uIFRoZXJlIGlzIGEgcG90ZW50aWFsIGlzc3VlIGhlcmUgaW4gdGhhdCBub24tcGhwDQoJCS8vIGNvbnRlbnQgbWF5IGJlIHJlbW92ZWQgLi4uIGhvd2V2ZXIgZGVzaWduZXJzIHNob3VsZCB1c2UgZW50aXRpZXMNCgkJLy8gaWYgdGhleSB3aXNoIHRvIGRpc3BsYXkgPCBhbmQgPg0KCQkkdGhpcy0+cmVtb3ZlX3BocF90YWdzKCRjb2RlKTsNCgkJLy8gUHVsbCBvdXQgYWxsIGJsb2NrL3N0YXRlbWVudCBsZXZlbCBlbGVtZW50cyBhbmQgc2VwYXJhdGUgcGxhaW4gdGV4dA0KCQlwcmVnX21hdGNoX2FsbCgnIzwhLS0gUEhQIC0tPiguKj8pPCEtLSBFTkRQSFAgLS0+I3MnLCAkY29kZSwgJG1hdGNoZXMpOw0KCQkkcGhwX2Jsb2NrcyA9ICRtYXRjaGVzWzFdOw0KCQkkY29kZSA9IHByZWdfcmVwbGFjZSgnIzwhLS0gUEhQIC0tPi4qPzwhLS0gRU5EUEhQIC0tPiNzJywgJzwhLS0gUEhQIC0tPicsICRjb2RlKTsNCgkJcHJlZ19tYXRjaF9hbGwoJyM8IS0tIElOQ0xVREUgKFthLXpBLVowLTlcX1wtXCtcLi9dKykgLS0+IycsICRjb2RlLCAkbWF0Y2hlcyk7DQoJCSRpbmNsdWRlX2Jsb2NrcyA9ICRtYXRjaGVzWzFdOw0KCQkkY29kZSA9IHByZWdfcmVwbGFjZSgnIzwhLS0gSU5DTFVERSBbYS16QS1aMC05XF9cLVwrXC4vXSsgLS0+IycsICc8IS0tIElOQ0xVREUgLS0+JywgJGNvZGUpOw0KCQlwcmVnX21hdGNoX2FsbCgnIzwhLS0gSU5DTFVERVBIUCAoW2EtekEtWjAtOVxfXC1cK1wuL10rKSAtLT4jJywgJGNvZGUsICRtYXRjaGVzKTsNCgkJJGluY2x1ZGVwaHBfYmxvY2tzID0gJG1hdGNoZXNbMV07DQoJCSRjb2RlID0gcHJlZ19yZXBsYWNlKCcjPCEtLSBJTkNMVURFUEhQIFthLXpBLVowLTlcX1wtXCtcLi9dKyAtLT4jJywgJzwhLS0gSU5DTFVERVBIUCAtLT4nLCAkY29kZSk7DQoJCXByZWdfbWF0Y2hfYWxsKCcjPCEtLSAoW148XS4qPykgKC4qPyk/ID8tLT4jJywgJGNvZGUsICRibG9ja3MsIFBSRUdfU0VUX09SREVSKTsNCgkJJHRleHRfYmxvY2tzID0gcHJlZ19zcGxpdCgnIzwhLS0gW148XS4qPyAoPzouKj8pPyA/LS0+IycsICRjb2RlKTsNCgkJZm9yICgkaSA9IDAsICRqID0gc2l6ZW9mKCR0ZXh0X2Jsb2Nrcyk7ICRpIDwgJGo7ICRpKyspDQoJCXsNCgkJCSR0aGlzLT5jb21waWxlX3Zhcl90YWdzKCR0ZXh0X2Jsb2Nrc1skaV0pOw0KCQl9DQoJCSRjb21waWxlX2Jsb2NrcyA9IGFycmF5KCk7DQoJCWZvciAoJGN1cnJfdGIgPSAwLCAkdGJfc2l6ZSA9IHNpemVvZigkYmxvY2tzKTsgJGN1cnJfdGIgPCAkdGJfc2l6ZTsgJGN1cnJfdGIrKykNCgkJew0KCQkJJGJsb2NrX3ZhbCA9ICYkYmxvY2tzWyRjdXJyX3RiXTsNCgkJCXN3aXRjaCAoJGJsb2NrX3ZhbFsxXSkNCgkJCXsNCgkJCQljYXNlICdCRUdJTic6DQoJCQkJCSR0aGlzLT5ibG9ja19lbHNlX2xldmVsW10gPSBmYWxzZTsNCgkJCQkJJGNvbXBpbGVfYmxvY2tzW10gPSAnPD9waHAgJyAuICR0aGlzLT5jb21waWxlX3RhZ19ibG9jaygkYmxvY2tfdmFsWzJdKSAuICcgPz4nOw0KCQkJCQlicmVhazsNCgkJCQljYXNlICdCRUdJTkVMU0UnOg0KCQkJCQkkdGhpcy0+YmxvY2tfZWxzZV9sZXZlbFtzaXplb2YoJHRoaXMtPmJsb2NrX2Vsc2VfbGV2ZWwpIC0gMV0gPSB0cnVlOw0KCQkJCQkkY29tcGlsZV9ibG9ja3NbXSA9ICc8P3BocCB9fSBlbHNlIHsgPz4nOw0KCQkJCQlicmVhazsNCgkJCQljYXNlICdFTkQnOg0KCQkJCQlhcnJheV9wb3AoJHRoaXMtPmJsb2NrX25hbWVzKTsNCgkJCQkJJGNvbXBpbGVfYmxvY2tzW10gPSAnPD9waHAgJyAuICgoYXJyYXlfcG9wKCR0aGlzLT5ibG9ja19lbHNlX2xldmVsKSkgPyAnfScgOiAnfX0nKSAuICcgPz4nOw0KCQkJCQlicmVhazsNCgkJCQljYXNlICdJRic6DQoJCQkJCSRjb21waWxlX2Jsb2Nrc1tdID0gJzw/cGhwICcgLiAkdGhpcy0+Y29tcGlsZV90YWdfaWYoJGJsb2NrX3ZhbFsyXSwgZmFsc2UpIC4gJyA/Pic7DQoJCQkJCWJyZWFrOw0KCQkJCWNhc2UgJ0VMU0UnOg0KCQkJCQkkY29tcGlsZV9ibG9ja3NbXSA9ICc8P3BocCB9IGVsc2UgeyA/Pic7DQoJCQkJCWJyZWFrOw0KCQkJCWNhc2UgJ0VMU0VJRic6DQoJCQkJCSRjb21waWxlX2Jsb2Nrc1tdID0gJzw/cGhwICcgLiAkdGhpcy0+Y29tcGlsZV90YWdfaWYoJGJsb2NrX3ZhbFsyXSwgdHJ1ZSkgLiAnID8+JzsNCgkJCQkJYnJlYWs7DQoJCQkJY2FzZSAnRU5ESUYnOg0KCQkJCQkkY29tcGlsZV9ibG9ja3NbXSA9ICc8P3BocCB9ID8+JzsNCgkJCQkJYnJlYWs7DQoJCQkJY2FzZSAnREVGSU5FJzoNCgkJCQkJJGNvbXBpbGVfYmxvY2tzW10gPSAnPD9waHAgJyAuICR0aGlzLT5jb21waWxlX3RhZ19kZWZpbmUoJGJsb2NrX3ZhbFsyXSwgdHJ1ZSkgLiAnID8+JzsNCgkJCQkJYnJlYWs7DQoJCQkJY2FzZSAnVU5ERUZJTkUnOg0KCQkJCQkkY29tcGlsZV9ibG9ja3NbXSA9ICc8P3BocCAnIC4gJHRoaXMtPmNvbXBpbGVfdGFnX2RlZmluZSgkYmxvY2tfdmFsWzJdLCBmYWxzZSkgLiAnID8+JzsNCgkJCQkJYnJlYWs7DQoJCQkJY2FzZSAnSU5DTFVERSc6DQoJCQkJCSR0ZW1wID0gYXJyYXlfc2hpZnQoJGluY2x1ZGVfYmxvY2tzKTsNCgkJCQkJJGNvbXBpbGVfYmxvY2tzW10gPSAnPD9waHAgJyAuICR0aGlzLT5jb21waWxlX3RhZ19pbmNsdWRlKCR0ZW1wKSAuICcgPz4nOw0KCQkJCQkkdGhpcy0+X3RwbF9pbmNsdWRlKCR0ZW1wLCBmYWxzZSk7DQoJCQkJCWJyZWFrOw0KCQkJCWNhc2UgJ0lOQ0xVREVQSFAnOg0KCQkJCQkkY29tcGlsZV9ibG9ja3NbXSA9ICgkY29uZmlnWyd0cGxfYWxsb3dfcGhwJ10pID8gJzw/cGhwICcgLiAkdGhpcy0+Y29tcGlsZV90YWdfaW5jbHVkZV9waHAoYXJyYXlfc2hpZnQoJGluY2x1ZGVwaHBfYmxvY2tzKSkgLiAnID8+JyA6ICcnOw0KCQkJCQlicmVhazsNCgkJCQljYXNlICdQSFAnOg0KCQkJCQkkY29tcGlsZV9ibG9ja3NbXSA9ICgkY29uZmlnWyd0cGxfYWxsb3dfcGhwJ10pID8gJzw/cGhwICcgLiBhcnJheV9zaGlmdCgkcGhwX2Jsb2NrcykgLiAnID8+JyA6ICcnOw0KCQkJCQlicmVhazsNCgkJCQlkZWZhdWx0Og0KCQkJCQkkdGhpcy0+Y29tcGlsZV92YXJfdGFncygkYmxvY2tfdmFsWzBdKTsNCgkJCQkJJHRyaW1fY2hlY2sgPSB0cmltKCRibG9ja192YWxbMF0pOw0KCQkJCQkkY29tcGlsZV9ibG9ja3NbXSA9ICghJG5vX2VjaG8pID8gKCghZW1wdHkoJHRyaW1fY2hlY2spKSA/ICRibG9ja192YWxbMF0gOiAnJykgOiAoKCFlbXB0eSgkdHJpbV9jaGVjaykpID8gJGJsb2NrX3ZhbFswXSA6ICcnKTsNCgkJCQkJYnJlYWs7DQoJCQl9DQoJCX0NCgkJJHRlbXBsYXRlX3BocCA9ICcnOw0KCQlmb3IgKCRpID0gMCwgJHNpemUgPSBzaXplb2YoJHRleHRfYmxvY2tzKTsgJGkgPCAkc2l6ZTsgJGkrKykNCgkJew0KCQkJJHRyaW1fY2hlY2tfdGV4dCA9IHRyaW0oJHRleHRfYmxvY2tzWyRpXSk7DQoJCQkkdGVtcGxhdGVfcGhwIC49ICghJG5vX2VjaG8pID8gKCgkdHJpbV9jaGVja190ZXh0ICE9ICcnKSA/ICR0ZXh0X2Jsb2Nrc1skaV0gOiAnJykgLiAoKGlzc2V0KCRjb21waWxlX2Jsb2Nrc1skaV0pKSA/ICRjb21waWxlX2Jsb2Nrc1skaV0gOiAnJykgOiAoKCR0cmltX2NoZWNrX3RleHQgIT0gJycpID8gJHRleHRfYmxvY2tzWyRpXSA6ICcnKSAuICgoaXNzZXQoJGNvbXBpbGVfYmxvY2tzWyRpXSkpID8gJGNvbXBpbGVfYmxvY2tzWyRpXSA6ICcnKTsNCgkJfQ0KCQkvLyBUaGVyZSB3aWxsIGJlIGEgbnVtYmVyIG9mIG9jY2FzaW9ucyB3aGVyZSB3ZSBzd2l0Y2ggaW50byBhbmQgb3V0IG9mDQoJCS8vIFBIUCBtb2RlIGluc3RhbnRhbmVvdXNseS4gUmF0aGVyIHRoYW4gImJ1cmRlbiIgdGhlIHBhcnNlciB3aXRoIHRoaXMNCgkJLy8gd2UnbGwgc3RyaXAgb3V0IHN1Y2ggb2NjdXJlbmNlcywgbWluaW1pc2luZyBzdWNoIHN3aXRjaGluZw0KCQkkdGVtcGxhdGVfcGhwID0gc3RyX3JlcGxhY2UoJyA/Pjw/cGhwICcsICcgJywgJHRlbXBsYXRlX3BocCk7DQoJCXJldHVybiAoISRub19lY2hvKSA/ICR0ZW1wbGF0ZV9waHAgOiAiXCQkZWNob192YXIgLj0gJyIgLiAkdGVtcGxhdGVfcGhwIC4gIiciOw0KCX0NCgkvKioNCgkgKiBDb21waWxlIHZhcmlhYmxlcw0KCSAqIEBhY2Nlc3MgcHJpdmF0ZQ0KCSAqLw0KCXByaXZhdGUgZnVuY3Rpb24gY29tcGlsZV92YXJfdGFncygmJHRleHRfYmxvY2tzKQ0KCXsNCgkJLy8gY2hhbmdlIHRlbXBsYXRlIHZhcnJlZnMgaW50byBQSFAgdmFycmVmcw0KCQkkdmFycmVmcyA9IGFycmF5KCk7DQoJCS8vIFRoaXMgb25lIHdpbGwgaGFuZGxlIHZhcnJlZnMgV0lUSCBuYW1lc3BhY2VzDQoJCXByZWdfbWF0Y2hfYWxsKCcjXHsoKD86W2EtejAtOVwtX10rXC4pKykoXCQpPyhbQS1aMC05XC1fXSspXH0jJywgJHRleHRfYmxvY2tzLCAkdmFycmVmcywgUFJFR19TRVRfT1JERVIpOw0KCQlmb3JlYWNoICgkdmFycmVmcyBhcyAkdmFyX3ZhbCkNCgkJew0KCQkJJG5hbWVzcGFjZSA9ICR2YXJfdmFsWzFdOw0KCQkJJHZhcm5hbWUgPSAkdmFyX3ZhbFszXTsNCgkJCSRuZXcgPSAkdGhpcy0+Z2VuZXJhdGVfYmxvY2tfdmFycmVmKCRuYW1lc3BhY2UsICR2YXJuYW1lLCB0cnVlLCAkdmFyX3ZhbFsyXSk7DQoJCQkkdGV4dF9ibG9ja3MgPSBzdHJfcmVwbGFjZSgkdmFyX3ZhbFswXSwgJG5ldywgJHRleHRfYmxvY2tzKTsNCgkJfQ0KCQkvLyBUaGlzIHdpbGwgaGFuZGxlIHRoZSByZW1haW5pbmcgcm9vdC1sZXZlbCB2YXJyZWZzDQoJCS8vIHRyYW5zZm9ybSB2YXJzIHByZWZpeGVkIGJ5IExfIGludG8gdGhlaXIgbGFuZ3VhZ2UgdmFyaWFibGUgcGVuZGFudCBpZiBub3RoaW5nIGlzIHNldCB3aXRoaW4gdGhlIHRwbGRhdGEgYXJyYXkNCgkJaWYgKHN0cnBvcygkdGV4dF9ibG9ja3MsICd7TF8nKSAhPT0gZmFsc2UpDQoJCXsNCgkJCSR0ZXh0X2Jsb2NrcyA9IHByZWdfcmVwbGFjZSgnI1x7TF8oW2EtejAtOVwtX10qKVx9I2lzJywgIjw/cGhwIGVjaG8gKChpc3NldChcJHRoaXMtPl9yb290cmVmWydMX1xcMSddKSkgPyBcJHRoaXMtPl9yb290cmVmWydMX1xcMSddIDogKChpc3NldChcJHRoaXMtPmxhbmdbJ1xcMSddKSkgPyBcJHRoaXMtPmxhbmdbJ1xcMSddIDogJ3sgXFwxIH0nKSk7ID8+IiwgJHRleHRfYmxvY2tzKTsNCgkJfQ0KCQkvLyBIYW5kbGUgYWRkc2xhc2hlZCBsYW5ndWFnZSB2YXJpYWJsZXMgcHJlZml4ZWQgd2l0aCBMQV8NCgkJLy8gSWYgYSB0ZW1wbGF0ZSB2YXJpYWJsZSBhbHJlYWR5IGV4aXN0LCBpdCB3aWxsIGJlIHVzZWQgaW4gZmF2b3Igb2YgaXQuLi4NCgkJaWYgKHN0cnBvcygkdGV4dF9ibG9ja3MsICd7TEFfJykgIT09IGZhbHNlKQ0KCQl7DQoJCQkkdGV4dF9ibG9ja3MgPSBwcmVnX3JlcGxhY2UoJyNce0xBXyhbYS16MC05XC1fXSopXH0jaXMnLCAiPD9waHAgZWNobyAoKGlzc2V0KFwkdGhpcy0+X3Jvb3RyZWZbJ0xBX1xcMSddKSkgPyBcJHRoaXMtPl9yb290cmVmWydMQV9cXDEnXSA6ICgoaXNzZXQoXCR0aGlzLT5fcm9vdHJlZlsnTF9cXDEnXSkpID8gYWRkc2xhc2hlcyhcJHRoaXMtPl9yb290cmVmWydMX1xcMSddKSA6ICgoaXNzZXQoXCR0aGlzLT5sYW5nWydcXDEnXSkpID8gYWRkc2xhc2hlcyhcJHRoaXMtPmxhbmdbJ1xcMSddKSA6ICd7IFxcMSB9JykpKTsgPz4iLCAkdGV4dF9ibG9ja3MpOw0KCQl9DQoJCS8vIEhhbmRsZSByZW1haW5pbmcgdmFycmVmcw0KCQkkdGV4dF9ibG9ja3MgPSBwcmVnX3JlcGxhY2UoJyNceyhbYS16MC05XC1fXSspXH0jaXMnLCAiPD9waHAgZWNobyAoaXNzZXQoXCR0aGlzLT5fcm9vdHJlZlsnXFwxJ10pKSA/IFwkdGhpcy0+X3Jvb3RyZWZbJ1xcMSddIDogJyc7ID8+IiwgJHRleHRfYmxvY2tzKTsNCgkJJHRleHRfYmxvY2tzID0gcHJlZ19yZXBsYWNlKCcjXHtcJChbYS16MC05XC1fXSspXH0jaXMnLCAiPD9waHAgZWNobyAoaXNzZXQoXCR0aGlzLT5fdHBsZGF0YVsnREVGSU5FJ11bJy4nXVsnXFwxJ10pKSA/IFwkdGhpcy0+X3RwbGRhdGFbJ0RFRklORSddWycuJ11bJ1xcMSddIDogJyc7ID8+IiwgJHRleHRfYmxvY2tzKTsNCgkJcmV0dXJuOw0KCX0NCgkvKioNCgkgKiBDb21waWxlIGJsb2Nrcw0KCSAqIEBhY2Nlc3MgcHJpdmF0ZQ0KCSAqLw0KCXByaXZhdGUgZnVuY3Rpb24gY29tcGlsZV90YWdfYmxvY2soJHRhZ19hcmdzKQ0KCXsNCgkJJG5vX25lc3RpbmcgPSBmYWxzZTsNCgkJLy8gSXMgdGhlIGRlc2lnbmVyIHdhbnRpbmcgdG8gY2FsbCBhbm90aGVyIGxvb3AgaW4gYSBsb29wPw0KCQlpZiAoc3RycG9zKCR0YWdfYXJncywgJyEnKSA9PT0gMCkNCgkJew0KCQkJLy8gQ291bnQgdGhlIG51bWJlciBpZiAhIG9jY3VycmVuY2VzIChub3QgYWxsb3dlZCBpbiB2YXJzKQ0KCQkJJG5vX25lc3RpbmcgPSBzdWJzdHJfY291bnQoJHRhZ19hcmdzLCAnIScpOw0KCQkJJHRhZ19hcmdzID0gc3Vic3RyKCR0YWdfYXJncywgJG5vX25lc3RpbmcpOw0KCQl9DQoJCS8vIEFsbG93IGZvciBjb250cm9sIG9mIGxvb3BpbmcgKGluZGV4ZXMgc3RhcnQgZnJvbSB6ZXJvKToNCgkJLy8gZm9vKDIpIDogV2lsbCBzdGFydCB0aGUgbG9vcCBvbiB0aGUgM3JkIGVudHJ5DQoJCS8vIGZvbygtMikgOiBXaWxsIHN0YXJ0IHRoZSBsb29wIHR3byBlbnRyaWVzIGZyb20gdGhlIGVuZA0KCQkvLyBmb28oMyw0KSA6IFdpbGwgc3RhcnQgdGhlIGxvb3Agb24gdGhlIGZvdXJ0aCBlbnRyeSBhbmQgZW5kIGl0IG9uIHRoZSBmaWZ0aA0KCQkvLyBmb28oMywtNCkgOiBXaWxsIHN0YXJ0IHRoZSBsb29wIG9uIHRoZSBmb3VydGggZW50cnkgYW5kIGVuZCBpdCBmb3VyIGZyb20gbGFzdA0KCQlpZiAocHJlZ19tYXRjaCgnI14oW14oKV0qKVwoKFtcLVxkXSspKD86LChbXC1cZF0rKSk/XCkkIycsICR0YWdfYXJncywgJG1hdGNoKSkNCgkJew0KCQkJJHRhZ19hcmdzID0gJG1hdGNoWzFdOw0KCQkJaWYgKCRtYXRjaFsyXSA8IDApDQoJCQkkbG9vcF9zdGFydCA9ICcoJF8nIC4gJHRhZ19hcmdzIC4gJ19jb3VudCAnIC4gJG1hdGNoWzJdIC4gJyA8IDAgPyAwIDogJF8nIC4gJHRhZ19hcmdzIC4gJ19jb3VudCAnIC4gJG1hdGNoWzJdIC4gJyknOw0KCQkJZWxzZQ0KCQkJJGxvb3Bfc3RhcnQgPSAnKCRfJyAuICR0YWdfYXJncyAuICdfY291bnQgPCAnIC4gJG1hdGNoWzJdIC4gJyA/ICRfJyAuICR0YWdfYXJncyAuICdfY291bnQgOiAnIC4gJG1hdGNoWzJdIC4gJyknOw0KCQkJaWYgKHN0cmxlbigkbWF0Y2hbM10pIDwgMSB8fCAkbWF0Y2hbM10gPT0gLTEpDQoJCQkkbG9vcF9lbmQgPSAnJF8nIC4gJHRhZ19hcmdzIC4gJ19jb3VudCc7DQoJCQllbHNlIGlmICgkbWF0Y2hbM10gPj0gMCkNCgkJCSRsb29wX2VuZCA9ICcoJyAuICgkbWF0Y2hbM10gKyAxKSAuICcgPiAkXycgLiAkdGFnX2FyZ3MgLiAnX2NvdW50ID8gJF8nIC4gJHRhZ19hcmdzIC4gJ19jb3VudCA6ICcgLiAoJG1hdGNoWzNdICsgMSkgLiAnKSc7DQoJCQllbHNlIC8vaWYgKCRtYXRjaFszXSA8IC0xKQ0KCQkJJGxvb3BfZW5kID0gJyRfJyAuICR0YWdfYXJncyAuICdfY291bnQnIC4gKCRtYXRjaFszXSArIDEpOw0KCQl9DQoJCWVsc2UNCgkJew0KCQkJJGxvb3Bfc3RhcnQgPSAwOw0KCQkJJGxvb3BfZW5kID0gJyRfJyAuICR0YWdfYXJncyAuICdfY291bnQnOw0KCQl9DQoJCSR0YWdfdGVtcGxhdGVfcGhwID0gJyc7DQoJCWFycmF5X3B1c2goJHRoaXMtPmJsb2NrX25hbWVzLCAkdGFnX2FyZ3MpOw0KCQlpZiAoJG5vX25lc3RpbmcgIT09IGZhbHNlKQ0KCQl7DQoJCQkvLyBXZSBuZWVkIHRvIGltcGxvZGUgJG5vX25lc3RpbmcgdGltZXMgZnJvbSB0aGUgZW5kLi4uDQoJCQkkYmxvY2sgPSBhcnJheV9zbGljZSgkdGhpcy0+YmxvY2tfbmFtZXMsIC0kbm9fbmVzdGluZyk7DQoJCX0NCgkJZWxzZQ0KCQl7DQoJCQkkYmxvY2sgPSAkdGhpcy0+YmxvY2tfbmFtZXM7DQoJCX0NCgkJaWYgKHNpemVvZigkYmxvY2spIDwgMikNCgkJew0KCQkJLy8gQmxvY2sgaXMgbm90IG5lc3RlZC4NCgkJCSR0YWdfdGVtcGxhdGVfcGhwID0gJyRfJyAuICR0YWdfYXJncyAuICJfY291bnQgPSAoaXNzZXQoXCR0aGlzLT5fdHBsZGF0YVsnJHRhZ19hcmdzJ10pKSA/IHNpemVvZihcJHRoaXMtPl90cGxkYXRhWyckdGFnX2FyZ3MnXSkgOiAwOyI7DQoJCQkkdmFycmVmID0gIlwkdGhpcy0+X3RwbGRhdGFbJyR0YWdfYXJncyddIjsNCgkJfQ0KCQllbHNlDQoJCXsNCgkJCS8vIFRoaXMgYmxvY2sgaXMgbmVzdGVkLg0KCQkJLy8gR2VuZXJhdGUgYSBuYW1lc3BhY2Ugc3RyaW5nIGZvciB0aGlzIGJsb2NrLg0KCQkJJG5hbWVzcGFjZSA9IGltcGxvZGUoJy4nLCAkYmxvY2spOw0KCQkJLy8gR2V0IGEgcmVmZXJlbmNlIHRvIHRoZSBkYXRhIGFycmF5IGZvciB0aGlzIGJsb2NrIHRoYXQgZGVwZW5kcyBvbiB0aGUNCgkJCS8vIGN1cnJlbnQgaW5kaWNlcyBvZiBhbGwgcGFyZW50IGJsb2Nrcy4NCgkJCSR2YXJyZWYgPSAkdGhpcy0+Z2VuZXJhdGVfYmxvY2tfZGF0YV9yZWYoJG5hbWVzcGFjZSwgZmFsc2UpOw0KCQkJLy8gQ3JlYXRlIHRoZSBmb3IgbG9vcCBjb2RlIHRvIGl0ZXJhdGUgb3ZlciB0aGlzIGJsb2NrLg0KCQkJJHRhZ190ZW1wbGF0ZV9waHAgPSAnJF8nIC4gJHRhZ19hcmdzIC4gJ19jb3VudCA9IChpc3NldCgnIC4gJHZhcnJlZiAuICcpKSA/IHNpemVvZignIC4gJHZhcnJlZiAuICcpIDogMDsnOw0KCQl9DQoJCSR0YWdfdGVtcGxhdGVfcGhwIC49ICdpZiAoJF8nIC4gJHRhZ19hcmdzIC4gJ19jb3VudCkgeyc7DQoJCSR0YWdfdGVtcGxhdGVfcGhwIC49ICdmb3IgKCRfJyAuICR0YWdfYXJncyAuICdfaSA9ICcgLiAkbG9vcF9zdGFydCAuICc7ICRfJyAuICR0YWdfYXJncyAuICdfaSA8ICcgLiAkbG9vcF9lbmQgLiAnOyArKyRfJyAuICR0YWdfYXJncyAuICdfaSl7JzsNCgkJJHRhZ190ZW1wbGF0ZV9waHAgLj0gJyRfJy4gJHRhZ19hcmdzIC4gJ192YWwgPSAmJyAuICR2YXJyZWYgLiAnWyRfJy4gJHRhZ19hcmdzLiAnX2ldOyc7DQoJCXJldHVybiAkdGFnX3RlbXBsYXRlX3BocDsNCgl9DQoJLyoqDQoJICogQ29tcGlsZSBJRiB0YWdzIC0gbXVjaCBvZiB0aGlzIGlzIGZyb20gU21hcnR5IHdpdGgNCgkgKiBzb21lIGFkYXB0aW9ucyBmb3Igb3VyIGJsb2NrIGxldmVsIG1ldGhvZHMNCgkgKiBAYWNjZXNzIHByaXZhdGUNCgkgKi8NCglwcml2YXRlIGZ1bmN0aW9uIGNvbXBpbGVfdGFnX2lmKCR0YWdfYXJncywgJGVsc2VpZikNCgl7DQoJCS8vIFRva2VuaXplIGFyZ3MgZm9yICdpZicgdGFnLg0KCQlwcmVnX21hdGNoX2FsbCgnLyg/Og0KIlteIlxcXFxdKig/OlxcXFwuW14iXFxcXF0qKSoiIHwNClwnW15cJ1xcXFxdKig/OlxcXFwuW15cJ1xcXFxdKikqXCcgfA0KWygpLF0gfA0KW15ccygpLF0rKS94JywgJHRhZ19hcmdzLCAkbWF0Y2gpOw0KCQkkdG9rZW5zID0gJG1hdGNoWzBdOw0KCQkkaXNfYXJnX3N0YWNrID0gYXJyYXkoKTsNCgkJZm9yICgkaSA9IDAsICRzaXplID0gc2l6ZW9mKCR0b2tlbnMpOyAkaSA8ICRzaXplOyAkaSsrKQ0KCQl7DQoJCQkkdG9rZW4gPSAmJHRva2Vuc1skaV07DQoJCQlzd2l0Y2ggKCR0b2tlbikNCgkJCXsNCgkJCQljYXNlICchPT0nOg0KCQkJCWNhc2UgJz09PSc6DQoJCQkJY2FzZSAnPDwnOg0KCQkJCWNhc2UgJz4+JzoNCgkJCQljYXNlICd8JzoNCgkJCQljYXNlICdeJzoNCgkJCQljYXNlICcmJzoNCgkJCQljYXNlICd+JzoNCgkJCQljYXNlICcpJzoNCgkJCQljYXNlICcsJzoNCgkJCQljYXNlICcrJzoNCgkJCQljYXNlICctJzoNCgkJCQljYXNlICcqJzoNCgkJCQljYXNlICcvJzoNCgkJCQljYXNlICdAJzoNCgkJCQkJYnJlYWs7DQoJCQkJY2FzZSAnPT0nOg0KCQkJCWNhc2UgJ2VxJzoNCgkJCQkJJHRva2VuID0gJz09JzsNCgkJCQkJYnJlYWs7DQoJCQkJY2FzZSAnIT0nOg0KCQkJCWNhc2UgJzw+JzoNCgkJCQljYXNlICduZSc6DQoJCQkJY2FzZSAnbmVxJzoNCgkJCQkJJHRva2VuID0gJyE9JzsNCgkJCQkJYnJlYWs7DQoJCQkJY2FzZSAnPCc6DQoJCQkJY2FzZSAnbHQnOg0KCQkJCQkkdG9rZW4gPSAnPCc7DQoJCQkJCWJyZWFrOw0KCQkJCWNhc2UgJzw9JzoNCgkJCQljYXNlICdsZSc6DQoJCQkJY2FzZSAnbHRlJzoNCgkJCQkJJHRva2VuID0gJzw9JzsNCgkJCQkJYnJlYWs7DQoJCQkJY2FzZSAnPic6DQoJCQkJY2FzZSAnZ3QnOg0KCQkJCQkkdG9rZW4gPSAnPic7DQoJCQkJCWJyZWFrOw0KCQkJCWNhc2UgJz49JzoNCgkJCQljYXNlICdnZSc6DQoJCQkJY2FzZSAnZ3RlJzoNCgkJCQkJJHRva2VuID0gJz49JzsNCgkJCQkJYnJlYWs7DQoJCQkJY2FzZSAnJiYnOg0KCQkJCWNhc2UgJ2FuZCc6DQoJCQkJCSR0b2tlbiA9ICcmJic7DQoJCQkJCWJyZWFrOw0KCQkJCWNhc2UgJ3x8JzoNCgkJCQljYXNlICdvcic6DQoJCQkJCSR0b2tlbiA9ICd8fCc7DQoJCQkJCWJyZWFrOw0KCQkJCWNhc2UgJyEnOg0KCQkJCWNhc2UgJ25vdCc6DQoJCQkJCSR0b2tlbiA9ICchJzsNCgkJCQkJYnJlYWs7DQoJCQkJY2FzZSAnJSc6DQoJCQkJY2FzZSAnbW9kJzoNCgkJCQkJJHRva2VuID0gJyUnOw0KCQkJCQlicmVhazsNCgkJCQljYXNlICcoJzoNCgkJCQkJYXJyYXlfcHVzaCgkaXNfYXJnX3N0YWNrLCAkaSk7DQoJCQkJCWJyZWFrOw0KCQkJCWNhc2UgJ2lzJzoNCgkJCQkJJGlzX2FyZ19zdGFydCA9ICgkdG9rZW5zWyRpLTFdID09ICcpJykgPyBhcnJheV9wb3AoJGlzX2FyZ19zdGFjaykgOiAkaS0xOw0KCQkJCQkkaXNfYXJnID0gaW1wbG9kZSgnICcsIGFycmF5X3NsaWNlKCR0b2tlbnMsICRpc19hcmdfc3RhcnQsICRpIC0gJGlzX2FyZ19zdGFydCkpOw0KCQkJCQkkbmV3X3Rva2VucyA9ICR0aGlzLT5fcGFyc2VfaXNfZXhwcigkaXNfYXJnLCBhcnJheV9zbGljZSgkdG9rZW5zLCAkaSsxKSk7DQoJCQkJCWFycmF5X3NwbGljZSgkdG9rZW5zLCAkaXNfYXJnX3N0YXJ0LCBzaXplb2YoJHRva2VucyksICRuZXdfdG9rZW5zKTsNCgkJCQkJJGkgPSAkaXNfYXJnX3N0YXJ0Ow0KCQkJCQkvLyBubyBicmVhaw0KCQkJCWRlZmF1bHQ6DQoJCQkJCWlmIChwcmVnX21hdGNoKCcjXigoPzpbYS16MC05XC1fXStcLikrKT8oXCQpPyg/PVtBLVpdKShbQS1aMC05XC1fXSspI3MnLCAkdG9rZW4sICR2YXJyZWZzKSkNCgkJCQkJew0KCQkJCQkJJHRva2VuID0gKCFlbXB0eSgkdmFycmVmc1sxXSkpID8gJHRoaXMtPmdlbmVyYXRlX2Jsb2NrX2RhdGFfcmVmKHN1YnN0cigkdmFycmVmc1sxXSwgMCwgLTEpLCB0cnVlLCAkdmFycmVmc1syXSkgLiAnW1wnJyAuICR2YXJyZWZzWzNdIC4gJ1wnXScgOiAoKCR2YXJyZWZzWzJdKSA/ICckdGhpcy0+X3RwbGRhdGFbXCdERUZJTkVcJ11bXCcuXCddW1wnJyAuICR2YXJyZWZzWzNdIC4gJ1wnXScgOiAnJHRoaXMtPl9yb290cmVmW1wnJyAuICR2YXJyZWZzWzNdIC4gJ1wnXScpOw0KCQkJCQl9DQoJCQkJCWVsc2UgaWYgKHByZWdfbWF0Y2goJyNeXC4oKD86W2EtejAtOVwtX10rXC4/KSspJCNzJywgJHRva2VuLCAkdmFycmVmcykpDQoJCQkJCXsNCgkJCQkJCS8vIEFsbG93IGNoZWNraW5nIGlmIGxvb3BzIGFyZSBzZXQgd2l0aCAubG9vcG5hbWUNCgkJCQkJCS8vIEl0IGlzIGFsc28gcG9zc2libGUgdG8gY2hlY2sgdGhlIGxvb3AgY291bnQgYnkgZG9pbmcgPCEtLSBJRiAubG9vcG5hbWUgPiAxIC0tPiBmb3IgZXhhbXBsZQ0KCQkJCQkJJGJsb2NrcyA9IGV4cGxvZGUoJy4nLCAkdmFycmVmc1sxXSk7DQoJCQkJCQkvLyBJZiB0aGUgYmxvY2sgaXMgbmVzdGVkLCB3ZSBoYXZlIGEgcmVmZXJlbmNlIHRoYXQgd2UgY2FuIGdyYWIuDQoJCQkJCQkvLyBJZiB0aGUgYmxvY2sgaXMgbm90IG5lc3RlZCwgd2UganVzdCBnbyBhbmQgZ3JhYiB0aGUgYmxvY2sgZnJvbSBfdHBsZGF0YQ0KCQkJCQkJaWYgKHNpemVvZigkYmxvY2tzKSA+IDEpDQoJCQkJCQl7DQoJCQkJCQkJJGJsb2NrID0gYXJyYXlfcG9wKCRibG9ja3MpOw0KCQkJCQkJCSRuYW1lc3BhY2UgPSBpbXBsb2RlKCcuJywgJGJsb2Nrcyk7DQoJCQkJCQkJJHZhcnJlZiA9ICR0aGlzLT5nZW5lcmF0ZV9ibG9ja19kYXRhX3JlZigkbmFtZXNwYWNlLCB0cnVlKTsNCgkJCQkJCQkvLyBBZGQgdGhlIGJsb2NrIHJlZmVyZW5jZSBmb3IgdGhlIGxhc3QgY2hpbGQuDQoJCQkJCQkJJHZhcnJlZiAuPSAiWyciIC4gJGJsb2NrIC4gIiddIjsNCgkJCQkJCX0NCgkJCQkJCWVsc2UNCgkJCQkJCXsNCgkJCQkJCQkkdmFycmVmID0gJyR0aGlzLT5fdHBsZGF0YSc7DQoJCQkJCQkJLy8gQWRkIHRoZSBibG9jayByZWZlcmVuY2UgZm9yIHRoZSBsYXN0IGNoaWxkLg0KCQkJCQkJCSR2YXJyZWYgLj0gIlsnIiAuICRibG9ja3NbMF0gLiAiJ10iOw0KCQkJCQkJfQ0KCQkJCQkJJHRva2VuID0gInNpemVvZigkdmFycmVmKSI7DQoJCQkJCX0NCgkJCQkJZWxzZSBpZiAoIWVtcHR5KCR0b2tlbikpDQoJCQkJCXsNCgkJCQkJCSR0b2tlbiA9ICcoJyAuICR0b2tlbiAuICcpJzsNCgkJCQkJfQ0KCQkJCQlicmVhazsNCgkJCX0NCgkJfQ0KCQkvLyBJZiB0aGVyZSBhcmUgbm8gdmFsaWQgdG9rZW5zIGxlZnQgb3Igb25seSBjb250cm9sL2NvbXBhcmUgY2hhcmFjdGVycyBsZWZ0LCB3ZSBkbyBza2lwIHRoaXMgc3RhdGVtZW50DQoJCWlmICghc2l6ZW9mKCR0b2tlbnMpIHx8IHN0cl9yZXBsYWNlKGFycmF5KCcgJywgJz0nLCAnIScsICc8JywgJz4nLCAnJicsICd8JywgJyUnLCAnKCcsICcpJyksICcnLCBpbXBsb2RlKCcnLCAkdG9rZW5zKSkgPT0gJycpDQoJCXsNCgkJCSR0b2tlbnMgPSBhcnJheSgnZmFsc2UnKTsNCgkJfQ0KCQlyZXR1cm4gKCgkZWxzZWlmKSA/ICd9IGVsc2UgaWYgKCcgOiAnaWYgKCcpIC4gKGltcGxvZGUoJyAnLCAkdG9rZW5zKSAuICcpIHsgJyk7DQoJfQ0KCS8qKg0KCSAqIENvbXBpbGUgREVGSU5FIHRhZ3MNCgkgKiBAYWNjZXNzIHByaXZhdGUNCgkgKi8NCglwcml2YXRlIGZ1bmN0aW9uIGNvbXBpbGVfdGFnX2RlZmluZSgkdGFnX2FyZ3MsICRvcCkNCgl7DQoJCXByZWdfbWF0Y2goJyNeKCg/OlthLXowLTlcLV9dK1wuKSspP1wkKD89W0EtWl0pKFtBLVowLTlfXC1dKikoPzogPSAoXCc/KShbXlwnXSopKFwnPykpPyQjJywgJHRhZ19hcmdzLCAkbWF0Y2gpOw0KCQlpZiAoZW1wdHkoJG1hdGNoWzJdKSB8fCAoIWlzc2V0KCRtYXRjaFs0XSkgJiYgJG9wKSkNCgkJcmV0dXJuICcnOw0KCQlpZiAoISRvcCkNCgkJcmV0dXJuICd1bnNldCgnIC4gKCgkbWF0Y2hbMV0pID8gJHRoaXMtPmdlbmVyYXRlX2Jsb2NrX2RhdGFfcmVmKHN1YnN0cigkbWF0Y2hbMV0sIDAsIC0xKSwgdHJ1ZSwgdHJ1ZSkgLiAnW1wnJyAuICRtYXRjaFsyXSAuICdcJ10nIDogJyR0aGlzLT5fdHBsZGF0YVtcJ0RFRklORVwnXVtcJy5cJ11bXCcnIC4gJG1hdGNoWzJdIC4gJ1wnXScpIC4gJyk7JzsNCgkJLy8gQXJlIHdlIGEgc3RyaW5nPw0KCQlpZiAoJG1hdGNoWzNdICYmICRtYXRjaFs1XSkNCgkJew0KCQkJJG1hdGNoWzRdID0gc3RyX3JlcGxhY2UoYXJyYXkoJ1xcXCcnLCAnXFxcXCcsICdcJycpLCBhcnJheSgnXCcnLCAnXFwnLCAnXFxcJycpLCAkbWF0Y2hbNF0pOw0KCQkJLy8gQ29tcGlsZSByZWZlcmVuY2UsIHdlIGFsbG93IHRlbXBsYXRlIHZhcmlhYmxlcyBpbiBkZWZpbmVzLi4uDQoJCQkkbWF0Y2hbNF0gPSAkdGhpcy0+Y29tcGlsZSgkbWF0Y2hbNF0pOw0KCQkJLy8gTm93IHJlcGxhY2UgdGhlIHBocCBjb2RlDQoJCQkkbWF0Y2hbNF0gPSAiJyIgLiBzdHJfcmVwbGFjZShhcnJheSgnPD9waHAgZWNobyAnLCAnOyA/PicpLCBhcnJheSgiJyAuICIsICIgLiAnIiksICRtYXRjaFs0XSkgLiAiJyI7DQoJCX0NCgkJZWxzZQ0KCQl7DQoJCQlwcmVnX21hdGNoKCcjdHJ1ZXxmYWxzZXxcLiNpJywgJG1hdGNoWzRdLCAkdHlwZSk7DQoJCQlzd2l0Y2ggKHN0cnRvbG93ZXIoJHR5cGVbMF0pKQ0KCQkJew0KCQkJCWNhc2UgJ3RydWUnOg0KCQkJCWNhc2UgJ2ZhbHNlJzoNCgkJCQkJJG1hdGNoWzRdID0gc3RydG91cHBlcigkbWF0Y2hbNF0pOw0KCQkJCQlicmVhazsNCgkJCQljYXNlICcuJzoNCgkJCQkJJG1hdGNoWzRdID0gZG91YmxldmFsKCRtYXRjaFs0XSk7DQoJCQkJCWJyZWFrOw0KCQkJCWRlZmF1bHQ6DQoJCQkJCSRtYXRjaFs0XSA9IGludHZhbCgkbWF0Y2hbNF0pOw0KCQkJCQlicmVhazsNCgkJCX0NCgkJfQ0KCQlyZXR1cm4gKCgkbWF0Y2hbMV0pID8gJHRoaXMtPmdlbmVyYXRlX2Jsb2NrX2RhdGFfcmVmKHN1YnN0cigkbWF0Y2hbMV0sIDAsIC0xKSwgdHJ1ZSwgdHJ1ZSkgLiAnW1wnJyAuICRtYXRjaFsyXSAuICdcJ10nIDogJyR0aGlzLT5fdHBsZGF0YVtcJ0RFRklORVwnXVtcJy5cJ11bXCcnIC4gJG1hdGNoWzJdIC4gJ1wnXScpIC4gJyA9ICcgLiAkbWF0Y2hbNF0gLiAnOyc7DQoJfQ0KCS8qKg0KCSAqIENvbXBpbGUgSU5DTFVERSB0YWcNCgkgKiBAYWNjZXNzIHByaXZhdGUNCgkgKi8NCglwcml2YXRlIGZ1bmN0aW9uIGNvbXBpbGVfdGFnX2luY2x1ZGUoJHRhZ19hcmdzKQ0KCXsNCgkJcmV0dXJuICJcJHRoaXMtPl90cGxfaW5jbHVkZSgnJHRhZ19hcmdzJyk7IjsNCgl9DQoJLyoqDQoJICogQ29tcGlsZSBJTkNMVURFX1BIUCB0YWcNCgkgKiBAYWNjZXNzIHByaXZhdGUNCgkgKi8NCglwcml2YXRlIGZ1bmN0aW9uIGNvbXBpbGVfdGFnX2luY2x1ZGVfcGhwKCR0YWdfYXJncykNCgl7DQoJCXJldHVybiAiaW5jbHVkZSgnIiAuICR0YWdfYXJncyAuICInKTsiOw0KCX0NCgkvKioNCgkgKiBwYXJzZSBleHByZXNzaW9uDQoJICogVGhpcyBpcyBmcm9tIFNtYXJ0eQ0KCSAqIEBhY2Nlc3MgcHJpdmF0ZQ0KCSAqLw0KCXByaXZhdGUgZnVuY3Rpb24gX3BhcnNlX2lzX2V4cHIoJGlzX2FyZywgJHRva2VucykNCgl7DQoJCSRleHByX2VuZCA9IDA7DQoJCSRuZWdhdGVfZXhwciA9IGZhbHNlOw0KCQlpZiAoKCRmaXJzdF90b2tlbiA9IGFycmF5X3NoaWZ0KCR0b2tlbnMpKSA9PSAnbm90JykNCgkJew0KCQkJJG5lZ2F0ZV9leHByID0gdHJ1ZTsNCgkJCSRleHByX3R5cGUgPSBhcnJheV9zaGlmdCgkdG9rZW5zKTsNCgkJfQ0KCQllbHNlDQoJCXsNCgkJCSRleHByX3R5cGUgPSAkZmlyc3RfdG9rZW47DQoJCX0NCgkJc3dpdGNoICgkZXhwcl90eXBlKQ0KCQl7DQoJCQljYXNlICdldmVuJzoNCgkJCQlpZiAoQCR0b2tlbnNbJGV4cHJfZW5kXSA9PSAnYnknKQ0KCQkJCXsNCgkJCQkJJGV4cHJfZW5kKys7DQoJCQkJCSRleHByX2FyZyA9ICR0b2tlbnNbJGV4cHJfZW5kKytdOw0KCQkJCQkkZXhwciA9ICIhKCgkaXNfYXJnIC8gJGV4cHJfYXJnKSAlICRleHByX2FyZykiOw0KCQkJCX0NCgkJCQllbHNlDQoJCQkJew0KCQkJCQkkZXhwciA9ICIhKCRpc19hcmcgJiAxKSI7DQoJCQkJfQ0KCQkJCWJyZWFrOw0KCQkJY2FzZSAnb2RkJzoNCgkJCQlpZiAoQCR0b2tlbnNbJGV4cHJfZW5kXSA9PSAnYnknKQ0KCQkJCXsNCgkJCQkJJGV4cHJfZW5kKys7DQoJCQkJCSRleHByX2FyZyA9ICR0b2tlbnNbJGV4cHJfZW5kKytdOw0KCQkJCQkkZXhwciA9ICIoKCRpc19hcmcgLyAkZXhwcl9hcmcpICUgJGV4cHJfYXJnKSI7DQoJCQkJfQ0KCQkJCWVsc2UNCgkJCQl7DQoJCQkJCSRleHByID0gIigkaXNfYXJnICYgMSkiOw0KCQkJCX0NCgkJCQlicmVhazsNCgkJCWNhc2UgJ2Rpdic6DQoJCQkJaWYgKEAkdG9rZW5zWyRleHByX2VuZF0gPT0gJ2J5JykNCgkJCQl7DQoJCQkJCSRleHByX2VuZCsrOw0KCQkJCQkkZXhwcl9hcmcgPSAkdG9rZW5zWyRleHByX2VuZCsrXTsNCgkJCQkJJGV4cHIgPSAiISgkaXNfYXJnICUgJGV4cHJfYXJnKSI7DQoJCQkJfQ0KCQkJCWJyZWFrOw0KCQl9DQoJCWlmICgkbmVnYXRlX2V4cHIpDQoJCXsNCgkJCSRleHByID0gIiEoJGV4cHIpIjsNCgkJfQ0KCQlhcnJheV9zcGxpY2UoJHRva2VucywgMCwgJGV4cHJfZW5kLCAkZXhwcik7DQoJCXJldHVybiAkdG9rZW5zOw0KCX0NCgkvKioNCgkgKiBHZW5lcmF0ZXMgYSByZWZlcmVuY2UgdG8gdGhlIGdpdmVuIHZhcmlhYmxlIGluc2lkZSB0aGUgZ2l2ZW4gKHBvc3NpYmx5IG5lc3RlZCkNCgkgKiBibG9jayBuYW1lc3BhY2UuIFRoaXMgaXMgYSBzdHJpbmcgb2YgdGhlIGZvcm06DQoJICogJyAuICR0aGlzLT5fdHBsZGF0YVsncGFyZW50J11bJF9wYXJlbnRfaV1bJyRjaGlsZDEnXVskX2NoaWxkMV9pXVsnJGNoaWxkMiddWyRfY2hpbGQyX2ldLi4uWyd2YXJuYW1lJ10gLiAnDQoJICogSXQncyByZWFkeSB0byBiZSBpbnNlcnRlZCBpbnRvIGFuICJlY2hvIiBsaW5lIGluIG9uZSBvZiB0aGUgdGVtcGxhdGVzLg0KCSAqIE5PVEU6IGV4cGVjdHMgYSB0cmFpbGluZyAiLiIgb24gdGhlIG5hbWVzcGFjZS4NCgkgKiBAYWNjZXNzIHByaXZhdGUNCgkgKi8NCglwcml2YXRlIGZ1bmN0aW9uIGdlbmVyYXRlX2Jsb2NrX3ZhcnJlZigkbmFtZXNwYWNlLCAkdmFybmFtZSwgJGVjaG8gPSB0cnVlLCAkZGVmb3AgPSBmYWxzZSkNCgl7DQoJCS8vIFN0cmlwIHRoZSB0cmFpbGluZyBwZXJpb2QuDQoJCSRuYW1lc3BhY2UgPSBzdWJzdHIoJG5hbWVzcGFjZSwgMCwgLTEpOw0KCQkvLyBHZXQgYSByZWZlcmVuY2UgdG8gdGhlIGRhdGEgYmxvY2sgZm9yIHRoaXMgbmFtZXNwYWNlLg0KCQkkdmFycmVmID0gJHRoaXMtPmdlbmVyYXRlX2Jsb2NrX2RhdGFfcmVmKCRuYW1lc3BhY2UsIHRydWUsICRkZWZvcCk7DQoJCS8vIFByZXBlbmQgdGhlIG5lY2Vzc2FyeSBjb2RlIHRvIHN0aWNrIHRoaXMgaW4gYW4gZWNobyBsaW5lLg0KCQkvLyBBcHBlbmQgdGhlIHZhcmlhYmxlIHJlZmVyZW5jZS4NCgkJJHZhcnJlZiAuPSAiWyckdmFybmFtZSddIjsNCgkJJHZhcnJlZiA9ICgkZWNobykgPyAiPD9waHAgZWNobyAkdmFycmVmOyA/PiIgOiAoKGlzc2V0KCR2YXJyZWYpKSA/ICR2YXJyZWYgOiAnJyk7DQoJCXJldHVybiAkdmFycmVmOw0KCX0NCgkvKioNCgkgKiBHZW5lcmF0ZXMgYSByZWZlcmVuY2UgdG8gdGhlIGFycmF5IG9mIGRhdGEgdmFsdWVzIGZvciB0aGUgZ2l2ZW4NCgkgKiAocG9zc2libHkgbmVzdGVkKSBibG9jayBuYW1lc3BhY2UuIFRoaXMgaXMgYSBzdHJpbmcgb2YgdGhlIGZvcm06DQoJICogJHRoaXMtPl90cGxkYXRhWydwYXJlbnQnXVskX3BhcmVudF9pXVsnJGNoaWxkMSddWyRfY2hpbGQxX2ldWyckY2hpbGQyJ11bJF9jaGlsZDJfaV0uLi5bJyRjaGlsZE4nXQ0KCSAqDQoJICogSWYgJGluY2x1ZGVfbGFzdF9pdGVyYXRvciBpcyB0cnVlLCB0aGVuIFskX2NoaWxkTl9pXSB3aWxsIGJlIGFwcGVuZGVkIHRvIHRoZSBmb3JtIHNob3duIGFib3ZlLg0KCSAqIE5PVEU6IGRvZXMgbm90IGV4cGVjdCBhIHRyYWlsaW5nICIuIiBvbiB0aGUgYmxvY2tuYW1lLg0KCSAqIEBhY2Nlc3MgcHJpdmF0ZQ0KCSAqLw0KCXByaXZhdGUgZnVuY3Rpb24gZ2VuZXJhdGVfYmxvY2tfZGF0YV9yZWYoJGJsb2NrbmFtZSwgJGluY2x1ZGVfbGFzdF9pdGVyYXRvciwgJGRlZm9wID0gZmFsc2UpDQoJew0KCQkvLyBHZXQgYW4gYXJyYXkgb2YgdGhlIGJsb2NrcyBpbnZvbHZlZC4NCgkJJGJsb2NrcyA9IGV4cGxvZGUoJy4nLCAkYmxvY2tuYW1lKTsNCgkJJGJsb2NrY291bnQgPSBzaXplb2YoJGJsb2NrcykgLSAxOw0KCQkvLyBERUZJTkUgaXMgbm90IGFuIGVsZW1lbnQgb2YgYW55IHJlZmVyZW5jZWQgdmFyaWFibGUsIHdlIG11c3QgdXNlIF90cGxkYXRhIHRvIGFjY2VzcyBpdA0KCQlpZiAoJGRlZm9wKQ0KCQl7DQoJCQkkdmFycmVmID0gJyR0aGlzLT5fdHBsZGF0YVtcJ0RFRklORVwnXSc7DQoJCQkvLyBCdWlsZCB1cCB0aGUgc3RyaW5nIHdpdGggZXZlcnl0aGluZyBidXQgdGhlIGxhc3QgY2hpbGQuDQoJCQlmb3IgKCRpID0gMDsgJGkgPCAkYmxvY2tjb3VudDsgJGkrKykNCgkJCXsNCgkJCQkkdmFycmVmIC49ICJbJyIgLiAkYmxvY2tzWyRpXSAuICInXVtcJF8iIC4gJGJsb2Nrc1skaV0gLiAnX2ldJzsNCgkJCX0NCgkJCS8vIEFkZCB0aGUgYmxvY2sgcmVmZXJlbmNlIGZvciB0aGUgbGFzdCBjaGlsZC4NCgkJCSR2YXJyZWYgLj0gIlsnIiAuICRibG9ja3NbJGJsb2NrY291bnRdIC4gIiddIjsNCgkJCS8vIEFkZCB0aGUgaXRlcmF0b3IgZm9yIHRoZSBsYXN0IGNoaWxkIGlmIHJlcXVyaWVkLg0KCQkJaWYgKCRpbmNsdWRlX2xhc3RfaXRlcmF0b3IpDQoJCQl7DQoJCQkJJHZhcnJlZiAuPSAnWyRfJyAuICRibG9ja3NbJGJsb2NrY291bnRdIC4gJ19pXSc7DQoJCQl9DQoJCQlyZXR1cm4gJHZhcnJlZjsNCgkJfQ0KCQllbHNlIGlmICgkaW5jbHVkZV9sYXN0X2l0ZXJhdG9yKQ0KCQl7DQoJCQlyZXR1cm4gJyRfJy4gJGJsb2Nrc1skYmxvY2tjb3VudF0gLiAnX3ZhbCc7DQoJCX0NCgkJZWxzZQ0KCQl7DQoJCQlyZXR1cm4gJyRfJy4gJGJsb2Nrc1skYmxvY2tjb3VudCAtIDFdIC4gJ192YWxbXCcnLiAkYmxvY2tzWyRibG9ja2NvdW50XS4gJ1wnXSc7DQoJCX0NCgl9DQoJLyoqDQoJICogV3JpdGUgY29tcGlsZWQgZmlsZSB0byBjYWNoZSBkaXJlY3RvcnkNCgkgKiBAYWNjZXNzIHByaXZhdGUNCgkgKi8NCglwcml2YXRlIGZ1bmN0aW9uIGNvbXBpbGVfd3JpdGUoJGhhbmRsZSwgJGRhdGEpDQoJew0KCQkkZmlsZW5hbWUgPSAkdGhpcy0+Y2FjaGVwYXRoIC4gc3RyX3JlcGxhY2UoJy8nLCAnLicsICR0aGlzLT5maWxlbmFtZVskaGFuZGxlXSkgLiAnLicgLiBzZWxmOjpQSFBFWDsNCgkJaWYgKCRmcCA9IEBmb3BlbigkZmlsZW5hbWUsICd3YicpKQ0KCQl7DQoJCQlAZmxvY2soJGZwLCBMT0NLX0VYKTsNCgkJCUBmd3JpdGUgKCRmcCwgJGRhdGEpOw0KCQkJQGZsb2NrKCRmcCwgTE9DS19VTik7DQoJCQlAZmNsb3NlKCRmcCk7DQoJCQkvKioqcGhwYmJfY2htb2QoJGZpbGVuYW1lLCBDSE1PRF9XUklURSk7Ki8NCgkJfQ0KCQlyZXR1cm47DQoJfQ0KfQ=="));
